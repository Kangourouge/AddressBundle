{% block google_search_widget %}
    {{ block('form_widget') }}

    <script type="text/javascript">
        (function(){
            var inputLocation = document.getElementById('{{ form.location.vars.id }}');
            var inputPlace = document.getElementById('{{ form.place.vars.id }}');

            inputLocation.addEventListener('place_changed', onPlaceChange);
            inputLocation.addEventListener('keydown', handleKeys);

            function onPlaceChange(event) {
                event.preventDefault();
                var autocomplete = event.target.autocompleteData;
                var place = autocomplete.getPlace();
                var data = {};

                data['address_components'] = place.address_components;
                data['formatted_address'] = place.formatted_address;
                data['coordinate'] = {};
                if (place.geometry) {
                    data['coordinate']['latitude'] = place.geometry.location.lat();
                    data['coordinate']['longitude'] = place.geometry.location.lng();
                }
                data['types'] = place.types;
                data['vicinity'] = place.vicinity;
                inputPlace.value = JSON.stringify(data);
            }

            function handleKeys(event) {
                if (event.keyCode === 13) { {# Ignore ENTER press #}
                    event.preventDefault();
                }
            }
        })();
    </script>
{% endblock %}
